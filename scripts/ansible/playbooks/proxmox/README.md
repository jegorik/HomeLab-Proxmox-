# Proxmox Host Management Playbooks

Playbooks for managing Proxmox VE hypervisor and VM/container operations.

## ğŸ“‹ Available Playbooks

### apply_fcos_ignition.yml

**Purpose**: Apply Ignition configuration to Fedora CoreOS VMs created by OpenTofu.

**Use Case**: Second stage of Fedora CoreOS deployment (after `tofu apply`).

**Requirements**:
- VM must exist (created by OpenTofu)
- Ansible user with sudo access on Proxmox host
- Ignition config file generated by OpenTofu

**Usage**:

```bash
# With variables file from OpenTofu
ansible-playbook apply_fcos_ignition.yml \
  -e @../../terraform/fedora_core/generated/<vm_name>-ansible-vars.yml

# With inline variables
ansible-playbook apply_fcos_ignition.yml \
  -e "vm_id=101" \
  -e "proxmox_node=pve" \
  -e "ignition_config_escaped='...'"
```

**Variables**:

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `vm_id` | âœ… | - | Proxmox VM ID |
| `proxmox_node` | âœ… | - | Proxmox node name |
| `ignition_config_escaped` | âœ… | - | Escaped Ignition JSON |
| `start_vm_after_ignition` | âŒ | `true` | Start VM after config |
| `wait_for_ssh` | âŒ | `true` | Wait for SSH access |
| `ssh_timeout` | âŒ | `300` | SSH timeout in seconds |

**Workflow**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Read Ignition  â”‚â”€â”€â”€â”€â–¶â”‚  qm set -args   â”‚â”€â”€â”€â”€â–¶â”‚  qm start VM    â”‚
â”‚  from vars file â”‚     â”‚  (fw_cfg)       â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  Wait for SSH   â”‚
                                               â”‚  (optional)     â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Adding New Proxmox Playbooks

When adding new playbooks to this category:

1. Focus on Proxmox host operations (`qm`, `pct`, `pvesh` commands)
2. Use `become: true` for privileged operations
3. Target `hosts: proxmox` group
4. Document required variables in playbook header

## ğŸ“š Related Resources

- [Proxmox VE Admin Guide](https://pve.proxmox.com/wiki/Main_Page)
- [qm Command Reference](https://pve.proxmox.com/pve-docs/qm.1.html)
- [Fedora CoreOS Ignition](https://docs.fedoraproject.org/en-US/fedora-coreos/producing-ign/)
